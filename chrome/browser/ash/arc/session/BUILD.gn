# Copyright 2024 The Chromium Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/config/chromeos/ui_mode.gni")

assert(is_chromeos)

static_library("service_launcher") {
  sources = [
    "arc_service_launcher.cc",
    "arc_service_launcher.h",
  ]

  deps = [
    ":session",
    "//ash/constants",
    "//base",
    "//chrome/browser/ash/app_list/arc",
    "//chrome/browser/ash/app_restore",
    "//chrome/browser/ash/apps",
    "//chrome/browser/ash/apps/webapk",
    "//chrome/browser/ash/arc:arc_util",
    "//chrome/browser/ash/arc/accessibility",
    "//chrome/browser/ash/arc/adbd",
    "//chrome/browser/ash/arc/auth",
    "//chrome/browser/ash/arc/bluetooth",
    "//chrome/browser/ash/arc/boot_phase_monitor",
    "//chrome/browser/ash/arc/enterprise",
    "//chrome/browser/ash/arc/enterprise/cert_store",
    "//chrome/browser/ash/arc/error_notification",
    "//chrome/browser/ash/arc/file_system_watcher",
    "//chrome/browser/ash/arc/fileapi",
    "//chrome/browser/ash/arc/idle_manager",
    "//chrome/browser/ash/arc/input_method_manager",
    "//chrome/browser/ash/arc/input_overlay",
    "//chrome/browser/ash/arc/instance_throttle",
    "//chrome/browser/ash/arc/intent_helper",
    "//chrome/browser/ash/arc/locked_fullscreen",
    "//chrome/browser/ash/arc/metrics",
    "//chrome/browser/ash/arc/nearby_share",
    "//chrome/browser/ash/arc/net",
    "//chrome/browser/ash/arc/notification",
    "//chrome/browser/ash/arc/pip",
    "//chrome/browser/ash/arc/policy",
    "//chrome/browser/ash/arc/print_spooler",
    "//chrome/browser/ash/arc/privacy_items",
    "//chrome/browser/ash/arc/screen_capture",
    "//chrome/browser/ash/arc/sharesheet",
    "//chrome/browser/ash/arc/survey",
    "//chrome/browser/ash/arc/tracing",
    "//chrome/browser/ash/arc/tts",
    "//chrome/browser/ash/arc/user_session",
    "//chrome/browser/ash/arc/vmm",
    "//chrome/browser/ash/arc/wallpaper",
    "//chrome/browser/ash/login",
    "//chrome/browser/ash/profiles",
    "//chrome/browser/profiles:profile",
    "//chrome/browser/ui/ash/multi_user",
    "//chromeos/ash/components/browser_context_helper",
    "//chromeos/ash/components/channel",
    "//chromeos/ash/components/dbus/cdm_factory_daemon",
    "//chromeos/ash/components/memory",
    "//chromeos/ash/components/settings",
    "//chromeos/ash/experiences/arc",
    "//chromeos/ash/experiences/arc:arc_base_utils",
    "//chromeos/ash/experiences/arc:arc_features",
    "//chromeos/ash/experiences/arc/intent_helper",
    "//chromeos/ash/experiences/arc/keymaster",
    "//chromeos/ash/experiences/arc/keymint",
    "//chromeos/ash/experiences/arc/media_session",
    "//chromeos/ash/experiences/arc/oemcrypto",
    "//chromeos/ash/experiences/arc/process",
    "//chromeos/ash/experiences/arc/session",
    "//chromeos/ash/experiences/arc/video",
    "//chromeos/dbus/tpm_manager",
    "//chromeos/dbus/tpm_manager:tpm_manager_proto",
    "//components/account_id",
    "//components/prefs",
    "//media:media_buildflags",
    "//mojo/public/cpp/bindings",

    # Deps for allow_circular_includes_from.
    "//chrome/browser/ash/login/session",
  ]

  allow_circular_includes_from = [ "//chrome/browser/ash/login/session" ]
}

static_library("session") {
  sources = [
    "adb_sideloading_availability_delegate_impl.cc",
    "adb_sideloading_availability_delegate_impl.h",
    "arc_activation_necessity_checker.cc",
    "arc_activation_necessity_checker.h",
    "arc_app_id_provider_impl.cc",
    "arc_app_id_provider_impl.h",
    "arc_disk_space_monitor.cc",
    "arc_disk_space_monitor.h",
    "arc_initial_optin_metrics_recorder.cc",
    "arc_initial_optin_metrics_recorder.h",
    "arc_initial_optin_metrics_recorder_factory.cc",
    "arc_initial_optin_metrics_recorder_factory.h",
    "arc_play_store_enabled_preference_handler.cc",
    "arc_play_store_enabled_preference_handler.h",
    "arc_provisioning_result.cc",
    "arc_provisioning_result.h",
    "arc_requirement_checker.cc",
    "arc_requirement_checker.h",
    "arc_session_manager.cc",
    "arc_session_manager.h",
    "arc_session_manager_observer.h",
    "arc_vm_data_migration_necessity_checker.cc",
    "arc_vm_data_migration_necessity_checker.h",
  ]

  public_deps = [ "//chrome/browser:browser_public_dependencies" ]

  deps = [
    "//chrome/browser:browser_process",
    "//chrome/browser:global_features",
    "//chrome/browser/ash/app_list/arc",
    "//chrome/browser/ash/arc:arc_util",
    "//chrome/browser/ash/arc/auth",
    "//chrome/browser/ash/arc/boot_phase_monitor",
    "//chrome/browser/ash/arc/intent_helper",
    "//chrome/browser/ash/arc/optin",
    "//chrome/browser/ash/arc/policy",
    "//chrome/browser/ash/crostini",
    "//chrome/browser/ash/file_manager",
    "//chrome/browser/ash/guest_os/public",
    "//chrome/browser/ash/login/demo_mode",
    "//chrome/browser/ash/platform_keys/key_permissions",
    "//chrome/browser/ash/policy/arc",
    "//chrome/browser/ash/policy/core",
    "//chrome/browser/ash/policy/handlers",
    "//chrome/browser/ash/profiles",
    "//chrome/browser/consent_auditor",
    "//chrome/browser/notifications",
    "//chrome/browser/prefs:util",
    "//chrome/browser/signin",
    "//chrome/browser/ui/webui/ash/diagnostics_dialog",
    "//chromeos/ash/components/cryptohome",
    "//chromeos/ash/components/dbus/arc",
    "//chromeos/ash/components/dbus/arc:arcvm_data_migrator_proto_lib",
    "//chromeos/ash/components/dbus/concierge",
    "//chromeos/ash/components/dbus/session_manager",
    "//chromeos/ash/components/dbus/spaced",
    "//chromeos/ash/components/demo_mode",
    "//chromeos/ash/components/install_attributes",
    "//chromeos/ash/components/memory",
    "//chromeos/ash/experiences/arc",
    "//chromeos/ash/experiences/arc:arc_app_constants",
    "//chromeos/ash/experiences/arc:arc_base_utils",
    "//chromeos/ash/experiences/arc:arc_features",
    "//chromeos/ash/experiences/arc:arc_metrics_constants",
    "//chromeos/ash/experiences/arc:prefs",
    "//chromeos/ash/experiences/arc/session",
    "//chromeos/ash/experiences/arc/session:arc_base_enums",
    "//components/consent_auditor",
    "//components/exo",
    "//components/session_manager/core",
    "//components/sync_preferences",
  ]

  allow_circular_includes_from = [
    "//chrome/browser/ash/app_list/arc",
    "//chrome/browser/ash/arc/auth",
    "//chrome/browser/ash/arc/boot_phase_monitor",
    "//chrome/browser/ash/arc/intent_helper",
    "//chrome/browser/ash/arc/policy",
    "//chrome/browser/ash/file_manager",
    "//chrome/browser/ash/platform_keys/key_permissions",
    "//chrome/browser/ash/policy/handlers",
  ]
}

source_set("unit_tests") {
  testonly = true

  sources = [
    "arc_activation_necessity_checker_unittest.cc",
    "arc_disk_space_monitor_unittest.cc",
    "arc_play_store_enabled_preference_handler_unittest.cc",
    "arc_provisioning_result_unittest.cc",
    "arc_session_manager_unittest.cc",
    "arc_vm_data_migration_necessity_checker_unittest.cc",
  ]

  deps = [
    ":session",
    "//base",
    "//base/test:test_support",
    "//chrome/app/vector_icons",
    "//chrome/browser/ash/app_list/arc:test_support",
    "//chrome/browser/ash/arc",
    "//chrome/browser/ash/arc:arc_util",
    "//chrome/browser/ash/arc/optin",
    "//chrome/browser/ash/arc/test:arc_test_support",
    "//chrome/browser/ash/login",
    "//chrome/browser/ash/login/demo_mode",
    "//chrome/browser/ash/login/users:test_support",
    "//chrome/browser/ash/policy/arc:test_support",
    "//chrome/browser/ash/settings",
    "//chrome/browser/ash/settings:test_support",
    "//chrome/browser/consent_auditor",
    "//chrome/browser/consent_auditor:test_support",
    "//chrome/browser/prefs",
    "//chrome/browser/ui/ash/login:test_support",
    "//chrome/browser/ui/ash/multi_user",
    "//chrome/test:test_support",
    "//chromeos/ash/components/browser_context_helper",
    "//chromeos/ash/components/dbus/arc",
    "//chromeos/ash/components/dbus/concierge",
    "//chromeos/ash/components/dbus/resourced",
    "//chromeos/ash/components/dbus/spaced",
    "//chromeos/ash/components/dbus/upstart",
    "//chromeos/ash/components/memory",
    "//chromeos/ash/experiences/arc",
    "//chromeos/ash/experiences/arc:arc_test_support",
    "//components/account_id:test_support",
    "//components/session_manager/core",
    "//components/session_manager/core:test_support",
    "//components/strings:components_strings_grit",
    "//content/test:test_support",
    "//testing/gtest",
    "//ui/base",
  ]
}

source_set("browser_tests") {
  testonly = true

  defines = [ "HAS_OUT_OF_PROC_TEST_RUNNER" ]

  sources = [ "arc_session_manager_browsertest.cc" ]

  deps = [
    ":service_launcher",
    ":session",
    "//base",
    "//chrome/browser",
    "//chrome/browser:browser_process",
    "//chrome/browser/ash/arc",
    "//chrome/browser/ash/arc:arc_util",
    "//chrome/browser/ash/arc/test:arc_test_support",
    "//chrome/browser/ash/certificate_provider",
    "//chrome/browser/ash/login/users:test_support",
    "//chrome/browser/ash/policy/test_support",
    "//chrome/browser/ash/test:test_support",
    "//chrome/browser/extensions",
    "//chrome/browser/profiles:profile",
    "//chrome/test:test_support",
    "//chromeos/ash/components/browser_context_helper",
    "//chromeos/ash/experiences/arc:arc_test_support",
    "//components/account_id",
    "//components/policy/core/common",
    "//components/policy/core/common:test_support",
    "//components/policy/test_support",
    "//components/prefs",
    "//components/signin/public/base",
    "//components/user_manager",
    "//content/public/browser",
    "//extensions:test_support",
    "//extensions/common",
    "//testing/gtest",
    "//url",
  ]
}
