// Copyright 2024 The Chromium Authors
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

module blink.mojom;

import "third_party/blink/public/mojom/on_device_translation/translator.mojom";

// The result of TranslationManager's CanCreateTranslator IPC.
enum CanCreateTranslatorResult {
  // Both the library and the language pack are ready.
  kReadily = 0,

  // The language packs are ready, but the library needs to be downloaded.
  kAfterDownloadLibraryNotReady = 1,

  // The library is ready, but the language packs need to be downloaded.
  kAfterDownloadLanguagePackNotReady = 2,

  // Both the library and the language packs need to be downloaded.
  kAfterDownloadLibraryAndLanguagePackNotReady = 3,

  // The translator cannot be created because the transltion for the specified
  // language pair is not supported.
  kNoNotSupportedLanguage = 4,

  // The translator cannot be created because the Accept-Language check failed.
  kNoAcceptLanguagesCheckFailed = 5,

  // The translator cannot be created. New models need to be downloaded,
  // but the number of downloaded language packs will exceedd the limit.
  kNoExceedsLanguagePackCountLimitation = 6,

  // The translator cannot be created, because the translator service crashed.
  kNoServiceCrashed = 7,

  // The translator cannot be created, because the use of Translator API is
  // disallowed by `TranslatorAPIAllowed` Enterprise policy
  kNoDisallowedByPolicy = 8,
};

// The client interface that receives a Translator from a TranslationManager.
interface TranslationManagerCreateTranslatorClient {
  // Called with a created Translator's mojo interface as a result for the
  // CreateTranslator() method of the TranslationManager. When failed to create
  // a Translator, this method is called with a null pending remote.
  OnResult(pending_remote<blink.mojom.Translator>? translator);
};

// This is used when creating a new Translator for Translator API.
// https://github.com/WICG/translation-api/
struct TranslatorCreateOptions {
  // This is `AITranslatorCreateOptions`'s `sourceLanguage` of Translator API.
  string source_lang;
  // This is `AITranslatorCreateOptions`'s `targetLanguage` of Translator API.
  string target_lang;
};

// The manager for on-device translation.
interface TranslationManager {
  // Returns if it is supported to create a translator that could translate
  // texts from `source_lang` to `target_lang`.
  CanCreateTranslator(
    string source_lang, string target_lang
  ) => (CanCreateTranslatorResult result);

  // Creates a translator that could translate texts from `source_lang`
  // to `target_lang` of the passed `options`. When the passed client is
  // disconnected, the creation process will be aborted.
  CreateTranslator(
    pending_remote<TranslationManagerCreateTranslatorClient> client,
    TranslatorCreateOptions options);
};
