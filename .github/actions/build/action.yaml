name: Build Chromium
description: Builds Chromium targets
runs:
  using: "composite"
  steps:
      - name: GN gen
        env:
          GN_ARGS: ${{ inputs.gn_args }}
        run: |
          cd src
          gn gen \
            --args='use_remoteexec=true use_siso=false v8_enable_debugging_features=false v8_dcheck_always_on=false rbe_cfg_dir="//.github/reclient_cfgs" ${{ env.GN_ARGS }}' \
            out/${{ matrix.platform }}_${{ matrix.config }}
        shell: bash
      - name: List GN args
        run: |
          cd src
          gn args --list --short --overrides-only out/${{ matrix.platform }}_${{ matrix.config }}
        shell: bash
      - name: Ninja build
        env:
          TARGETS_JSON: ${{ inputs.targets }}
        run: |
          set -ex
          cd src
          TARGETS=$(echo "${TARGETS_JSON}" | jq -cr '. | join(" ")')
          time autoninja \
                -C out/${{ matrix.platform }}_${{ matrix.config }} \
                ${TARGETS}
        shell: bash
