<!DOCTYPE html>
<html class="reftest-wait">
  <head>
    <title>texElementImage2D scaling</title>
    <link rel="help" href="https://github.com/WICG/html-in-canvas">
    <link rel="match" href="scale-ref.html">
    <link rel="stylesheet" href="/wpt_internal/resources/canvas-draw-element/styles.css" />
    <script src="/wpt_internal/resources/canvas-draw-element/color-grid.js"></script>
    <script src="/common/reftest-wait.js"></script>
    <meta name="assert" value="Scaling content via destRect">
    <style>
     body {
       display: grid;
       grid: 256px / 1fr 1fr 1fr;
       align-items: start;
     }
     canvas {
       width: 256px;
       height: 256px;
     }
     color-grid {
       width: 100px;
       height: 100px;
     }
    </style>
  </head>
  <body>
    <canvas layoutsubtree>
      <div class="draw-element-wrapper">
        <div class="css-is-awesome"></div>
      </div>
    </canvas>

    <canvas layoutsubtree>
      <div class="draw-element-wrapper" xscale="1" yscale="1">
        <color-grid></color-grid>
      </div>
    </canvas>

    <canvas layoutsubtree>
      <div class="draw-element-wrapper" xscale="0.5" yscale="0.5">
        <color-grid></color-grid>
      </div>
    </canvas>

    <canvas layoutsubtree>
      <div class="draw-element-wrapper" xscale="2" yscale="2">
        <color-grid></color-grid>
      </div>
    </canvas>

    <canvas layoutsubtree>
      <div class="draw-element-wrapper" xscale="2" yscale="0.5">
        <color-grid></color-grid>
      </div>
    </canvas>

    <script type="module">
import { resizeToPixelGrid, SimpleGLProgram } from "/wpt_internal/resources/canvas-draw-element/util.js";

Promise.all(Array.from(document.querySelectorAll("canvas")).map(async canvas => {
  await resizeToPixelGrid(canvas);
  const prog = new SimpleGLProgram(canvas.getContext("webgl2"));
  const target = canvas.firstElementChild;
  if (target.hasAttribute("xscale") && target.hasAttribute("yscale")) {
    const xscale = Number.parseFloat(target.getAttribute("xscale"));
    const yscale = Number.parseFloat(target.getAttribute("yscale"));
    prog.render(target, xscale, yscale);
  } else {
    prog.render(target);
  }
})).then(takeScreenshot);
    </script>
  </body>
</html>
