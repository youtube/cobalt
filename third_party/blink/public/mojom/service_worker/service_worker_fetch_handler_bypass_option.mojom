// Copyright 2023 The Chromium Authors
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.

module blink.mojom;

// Experimental feature (crbug.com/1371756). Not followed by the spec.
//
// Indicates the service worker fetch handler can be skipped. Independent from
// ServiceWorkerFetchHandlerType, since the fetch handler can be skipped based
// on the feature enabling, even if the fetch handler type is labeled as not
// skippable.
enum ServiceWorkerFetchHandlerBypassOption {
  kDefault,
  kBypassOnlyIfServiceWorkerNotStarted,
  kRaceNetworkRequest,
  kRaceNetworkRequestHoldback,
  kAutoPreload,
  // This is set in `ServiceWorkerMainResourceLoader` when
  // `ServiceWorkerSyntheticResponse` is involved.
  // `ServiceWorkerSyntheticResponse` is effective only for the main resource.
  // Subresources shouldn't be intercepted by service worker.
  //
  // TODO(crbug.com/447039330): This is used for the ablation study. Consider
  // removing this after the study, because `ServiceWorkerSyntheticResponse`
  // should not bypass subresource fetch handlers if any router rules or fetch
  // handlers are registered by service worker.
  kSyntheticResponse,
  // Similar to `kSyntheticResponse`, but this is used when
  // `ServiceWorkerSyntheticResponse` is enabled as a dry-run mode. Under the
  // dry-run mode, service worker intercepts main resource requests, but same as
  // `kSyntheticResponse` it shouldn't intercept subresources.
  //
  // TODO(crbug.com/447039330): This is used for the ablation study. Consider
  // removing this after the study, because `ServiceWorkerSyntheticResponse`
  // should not bypass subresource fetch handlers if any router rules or fetch
  // handlers are registered by service worker.
  kSyntheticResponseDryRunMode,
};
