<!DOCTYPE html>
<script src="../../resources/run-after-layout-and-paint.js"></script>
<svg>
  <linearGradient id="f">
    <stop stop-color="green"/>
  </linearGradient>
  <rect width="100" height="100" fill="url(#f) orange"/>
</svg>
<script>
runAfterLayoutAndPaint(function() {
  const svgNs = 'http://www.w3.org/2000/svg';
  let gradient = document.createElementNS(svgNs, 'linearGradient');
  let stop = gradient.appendChild(document.createElementNS(svgNs, 'stop'));
  stop.setAttribute('stop-color', 'red');
  gradient.id = 'f';

  let rect = document.querySelector('rect');
  document.querySelector('svg').insertBefore(gradient, rect);
  rect.getBoundingClientRect();
  rect.setAttribute('stroke-width', 0);
}, true);
</script>
