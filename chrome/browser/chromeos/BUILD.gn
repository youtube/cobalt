# Copyright 2014 The Chromium Authors
# Use of this source code is governed by a BSD-style license that can be
# found in the LICENSE file.

import("//build/config/chromeos/ui_mode.gni")
import("//build/config/ozone.gni")
import("//extensions/buildflags/buildflags.gni")
import("//ppapi/buildflags/buildflags.gni")
import("//printing/buildflags/buildflags.gni")
import("//third_party/protobuf/proto_library.gni")

assert(enable_extensions)
assert(is_chromeos)
assert(use_ozone)

source_set("chromeos") {
  configs += [ "//build/config/compiler:wexit_time_destructors" ]
  sources = [
    "app_mode/chrome_kiosk_app_installer.cc",
    "app_mode/chrome_kiosk_app_installer.h",
    "app_mode/chrome_kiosk_app_launcher.cc",
    "app_mode/chrome_kiosk_app_launcher.h",
    "app_mode/chrome_kiosk_external_loader_broker.cc",
    "app_mode/chrome_kiosk_external_loader_broker.h",
    "app_mode/kiosk_app_external_loader.cc",
    "app_mode/kiosk_app_external_loader.h",
    "app_mode/kiosk_app_service_launcher.cc",
    "app_mode/kiosk_app_service_launcher.h",
    "app_mode/kiosk_browser_session.cc",
    "app_mode/kiosk_browser_session.h",
    "app_mode/kiosk_browser_window_handler.cc",
    "app_mode/kiosk_browser_window_handler.h",
    "app_mode/kiosk_metrics_service.cc",
    "app_mode/kiosk_metrics_service.h",
    "app_mode/kiosk_policies.cc",
    "app_mode/kiosk_policies.h",
    "app_mode/kiosk_settings_navigation_throttle.cc",
    "app_mode/kiosk_settings_navigation_throttle.h",
    "app_mode/kiosk_troubleshooting_controller.cc",
    "app_mode/kiosk_troubleshooting_controller.h",
    "app_mode/startup_app_launcher_update_checker.cc",
    "app_mode/startup_app_launcher_update_checker.h",
    "app_mode/web_kiosk_app_installer.cc",
    "app_mode/web_kiosk_app_installer.h",
    "app_mode/web_kiosk_browser_controller_base.cc",
    "app_mode/web_kiosk_browser_controller_base.h",
    "arc/arc_external_protocol_dialog.cc",
    "arc/arc_external_protocol_dialog.h",
    "arc/arc_web_contents_data.cc",
    "arc/arc_web_contents_data.h",
    "arc/open_with_menu.cc",
    "arc/open_with_menu.h",
    "arc/start_smart_selection_action_menu.cc",
    "arc/start_smart_selection_action_menu.h",
    "enterprise/cloud_storage/policy_utils.cc",
    "enterprise/cloud_storage/policy_utils.h",
    "enterprise/incognito_navigation_throttle.cc",
    "enterprise/incognito_navigation_throttle.h",
    "extensions/accessibility_service_private.cc",
    "extensions/accessibility_service_private.h",
    "extensions/contact_center_insights/contact_center_insights_extension_manager.cc",
    "extensions/contact_center_insights/contact_center_insights_extension_manager.h",
    "extensions/device_local_account_external_policy_loader.cc",
    "extensions/device_local_account_external_policy_loader.h",
    "extensions/file_system_provider/service_worker_lifetime_manager.cc",
    "extensions/file_system_provider/service_worker_lifetime_manager.h",
    "extensions/info_private_api.cc",
    "extensions/info_private_api.h",
    "extensions/login_screen/login/cleanup/browser_cleanup_handler.cc",
    "extensions/login_screen/login/cleanup/browser_cleanup_handler.h",
    "extensions/login_screen/login/cleanup/cleanup_handler.h",
    "extensions/login_screen/login/cleanup/cleanup_manager.cc",
    "extensions/login_screen/login/cleanup/cleanup_manager.h",
    "extensions/login_screen/login/cleanup/extension_cleanup_handler.cc",
    "extensions/login_screen/login/cleanup/extension_cleanup_handler.h",
    "extensions/login_screen/login/cleanup/web_app_cleanup_handler.cc",
    "extensions/login_screen/login/cleanup/web_app_cleanup_handler.h",
    "extensions/login_screen/login/external_logout_request/external_logout_request_event_handler.cc",
    "extensions/login_screen/login/external_logout_request/external_logout_request_event_handler.h",
    "extensions/login_screen/login/external_logout_request/external_logout_request_event_handler_factory.cc",
    "extensions/login_screen/login/external_logout_request/external_logout_request_event_handler_factory.h",
    "extensions/login_screen/login/login_api.cc",
    "extensions/login_screen/login/login_api.h",
    "extensions/login_screen/login/login_api_prefs.cc",
    "extensions/login_screen/login/login_api_prefs.h",
    "extensions/login_screen/login_screen_storage/login_screen_storage_api.cc",
    "extensions/login_screen/login_screen_storage/login_screen_storage_api.h",
    "extensions/login_screen/login_state/login_state_api.cc",
    "extensions/login_screen/login_state/login_state_api.h",
    "extensions/login_screen/login_state/session_state_changed_event_dispatcher.cc",
    "extensions/login_screen/login_state/session_state_changed_event_dispatcher.h",
    "extensions/system_log/system_log_api.cc",
    "extensions/system_log/system_log_api.h",
    "extensions/web_file_handlers/intent_util.cc",
    "extensions/web_file_handlers/intent_util.h",
    "platform_keys/extension_key_permissions_service.cc",
    "platform_keys/extension_key_permissions_service.h",
    "platform_keys/extension_key_permissions_service_factory.cc",
    "platform_keys/extension_key_permissions_service_factory.h",
    "platform_keys/extension_platform_keys_service.cc",
    "platform_keys/extension_platform_keys_service.h",
    "platform_keys/extension_platform_keys_service_factory.cc",
    "platform_keys/extension_platform_keys_service_factory.h",
    "platform_keys/platform_keys.cc",
    "platform_keys/platform_keys.h",
    "policy/dlp/clipboard_bubble.cc",
    "policy/dlp/clipboard_bubble.h",
    "policy/dlp/data_transfer_dlp_controller.cc",
    "policy/dlp/data_transfer_dlp_controller.h",
    "policy/dlp/dialogs/dlp_warn_dialog.cc",
    "policy/dlp/dialogs/dlp_warn_dialog.h",
    "policy/dlp/dialogs/dlp_warn_notifier.cc",
    "policy/dlp/dialogs/dlp_warn_notifier.h",
    "policy/dlp/dialogs/policy_dialog_base.cc",
    "policy/dlp/dialogs/policy_dialog_base.h",
    "policy/dlp/dlp_clipboard_bubble_constants.h",
    "policy/dlp/dlp_clipboard_notifier.cc",
    "policy/dlp/dlp_clipboard_notifier.h",
    "policy/dlp/dlp_confidential_contents.cc",
    "policy/dlp/dlp_confidential_contents.h",
    "policy/dlp/dlp_confidential_file.cc",
    "policy/dlp/dlp_confidential_file.h",
    "policy/dlp/dlp_content_manager.cc",
    "policy/dlp/dlp_content_manager.h",
    "policy/dlp/dlp_content_manager_observer.h",
    "policy/dlp/dlp_content_observer.cc",
    "policy/dlp/dlp_content_observer.h",
    "policy/dlp/dlp_content_restriction_set.cc",
    "policy/dlp/dlp_content_restriction_set.h",
    "policy/dlp/dlp_content_tab_helper.cc",
    "policy/dlp/dlp_content_tab_helper.h",
    "policy/dlp/dlp_copy_or_move_hook_delegate.cc",
    "policy/dlp/dlp_copy_or_move_hook_delegate.h",
    "policy/dlp/dlp_data_transfer_notifier.cc",
    "policy/dlp/dlp_data_transfer_notifier.h",
    "policy/dlp/dlp_download_observer.cc",
    "policy/dlp/dlp_download_observer.h",
    "policy/dlp/dlp_download_observer_factory.cc",
    "policy/dlp/dlp_download_observer_factory.h",
    "policy/dlp/dlp_drag_drop_notifier.cc",
    "policy/dlp/dlp_drag_drop_notifier.h",
    "policy/dlp/dlp_file_access_copy_or_move_delegate_factory.cc",
    "policy/dlp/dlp_file_access_copy_or_move_delegate_factory.h",
    "policy/dlp/dlp_file_destination.cc",
    "policy/dlp/dlp_file_destination.h",
    "policy/dlp/dlp_files_controller.cc",
    "policy/dlp/dlp_files_controller.h",
    "policy/dlp/dlp_files_utils.cc",
    "policy/dlp/dlp_files_utils.h",
    "policy/dlp/dlp_notification_helper.cc",
    "policy/dlp/dlp_notification_helper.h",
    "policy/dlp/dlp_policy_constants.h",
    "policy/dlp/dlp_rules_manager.cc",
    "policy/dlp/dlp_rules_manager.h",
    "policy/dlp/dlp_rules_manager_factory.cc",
    "policy/dlp/dlp_rules_manager_factory.h",
    "policy/dlp/dlp_rules_manager_impl.cc",
    "policy/dlp/dlp_rules_manager_impl.h",
    "policy/dlp/dlp_scoped_file_access_delegate.cc",
    "policy/dlp/dlp_scoped_file_access_delegate.h",
    "quickoffice/quickoffice_prefs.cc",
    "quickoffice/quickoffice_prefs.h",
    "reporting/metric_default_utils.cc",
    "reporting/metric_default_utils.h",
    "reporting/metric_reporting_manager_delegate_base.cc",
    "reporting/metric_reporting_manager_delegate_base.h",
    "reporting/metric_reporting_prefs.cc",
    "reporting/metric_reporting_prefs.h",
    "reporting/network/network_bandwidth_sampler.cc",
    "reporting/network/network_bandwidth_sampler.h",
    "reporting/usage_telemetry_periodic_collector_base.cc",
    "reporting/usage_telemetry_periodic_collector_base.h",
    "reporting/user_reporting_settings.cc",
    "reporting/user_reporting_settings.h",
    "reporting/websites/website_events_observer.cc",
    "reporting/websites/website_events_observer.h",
    "reporting/websites/website_metrics_retriever_interface.h",
    "reporting/websites/website_usage_observer.cc",
    "reporting/websites/website_usage_observer.h",
    "reporting/websites/website_usage_telemetry_sampler.cc",
    "reporting/websites/website_usage_telemetry_sampler.h",
    "smart_reader/smart_reader_client_impl.cc",
    "smart_reader/smart_reader_client_impl.h",
    "tablet_mode/chrome_content_browser_client_tablet_mode_part.cc",
    "tablet_mode/chrome_content_browser_client_tablet_mode_part.h",
    "tablet_mode/tablet_mode_page_behavior.cc",
    "tablet_mode/tablet_mode_page_behavior.h",
    "tast_support/stack_sampling_recorder.cc",
    "tast_support/stack_sampling_recorder.h",
    "upload_office_to_cloud/upload_office_to_cloud.cc",
    "upload_office_to_cloud/upload_office_to_cloud.h",
    "video_conference/video_conference_manager_client.cc",
    "video_conference/video_conference_manager_client.h",
    "video_conference/video_conference_manager_client_common.cc",
    "video_conference/video_conference_manager_client_common.h",
    "video_conference/video_conference_media_listener.cc",
    "video_conference/video_conference_media_listener.h",
    "video_conference/video_conference_ukm_helper.cc",
    "video_conference/video_conference_ukm_helper.h",
    "video_conference/video_conference_web_app.cc",
    "video_conference/video_conference_web_app.h",

    # Extension API implementations.
    "extensions/desk_api/desk_api_extension_manager.cc",
    "extensions/desk_api/desk_api_extension_manager.h",
    "extensions/echo_private/echo_private_api.cc",
    "extensions/echo_private/echo_private_api.h",
    "extensions/file_system_provider/file_system_provider_api.cc",
    "extensions/file_system_provider/file_system_provider_api.h",
    "extensions/file_system_provider/provider_function.cc",
    "extensions/file_system_provider/provider_function.h",
    "extensions/login_screen/login/errors.cc",
    "extensions/login_screen/login/errors.h",
    "extensions/wallpaper_api.cc",
    "extensions/wallpaper_api.h",
  ]
  allow_circular_includes_from = [
    "//chrome/browser/extensions",
    "//chrome/browser/apps/app_service",
  ]
  public_deps = [
    "//base",
    "//build:chromeos_buildflags",
    "//chrome/browser/extensions",
    "//chrome/browser/image_decoder",
    "//chrome/browser/profiles",
    "//chrome/browser/profiles:profile",
    "//chrome/browser/web_applications",
    "//chrome/common/extensions/api",
    "//chromeos/crosapi/cpp",
    "//chromeos/crosapi/mojom",
    "//chromeos/dbus/dlp:dlp_proto",
    "//chromeos/dbus/power",
    "//components/account_id",
    "//components/arc/common",
    "//components/enterprise/data_controls:dlp_policy_event_proto",
    "//components/file_access",
    "//components/keyed_service/content",
    "//components/keyed_service/core",
    "//components/prefs",
    "//components/renderer_context_menu",
    "//components/reporting/client:report_queue",
    "//components/reporting/client:report_queue_configuration",
    "//components/reporting/metrics:metrics_data_collection",
    "//components/reporting/util:status",
    "//components/url_matcher",
    "//content/public/browser",
    "//extensions/browser",
    "//extensions/common",
    "//mojo/public/cpp/bindings",
    "//net",
    "//ppapi/buildflags",
    "//services/network/public/cpp",
    "//storage/browser",
    "//third_party/abseil-cpp:absl",
    "//ui/base",
    "//ui/base/clipboard",
    "//ui/base/data_transfer_policy",
    "//ui/base/metadata",
    "//ui/display",
    "//ui/gfx",
    "//ui/gfx/geometry",
    "//ui/views",
    "//url",
  ]
  deps = [
    ":system_stack_sampled_metrics_status_proto",
    "//chrome/app:command_ids",
    "//chrome/app:generated_resources",
    "//chrome/app/vector_icons",
    "//chrome/browser:browser_process",
    "//chrome/browser:resources",
    "//chrome/browser/apps/app_service",
    "//chrome/browser/apps/link_capturing",
    "//chrome/browser/browsing_data:constants",
    "//chrome/browser/enterprise/data_controls",
    "//chrome/browser/favicon",
    "//chrome/browser/resources:component_extension_resources",
    "//chrome/common",
    "//chrome/common:chrome_features",
    "//chrome/common:constants",
    "//chrome/common:non_code_constants",
    "//chromeos/components/kcer",
    "//chromeos/components/kcer:key_permissions_proto",
    "//chromeos/constants",
    "//chromeos/dbus/dlp",
    "//chromeos/ui/base",
    "//components/app_constants",
    "//components/arc/common:arc_intent_helper_constants",
    "//components/device_event_log",
    "//components/download/content/public:public",
    "//components/enterprise/data_controls",
    "//components/policy:generated",
    "//components/policy/core/common",
    "//components/policy/core/common:common_constants",
    "//components/policy/core/common:policy_namespace",
    "//components/pref_registry",
    "//components/reporting/client:report_queue_factory",
    "//components/reporting/proto:metric_data_proto",
    "//components/reporting/util:rate_limiter_interface",
    "//components/services/app_service",
    "//components/strings:components_strings",
    "//components/sync/protocol",
    "//components/sync_device_info",
    "//components/ukm",
    "//components/vector_icons",
    "//components/webapps/common",
    "//content/public/common",
    "//crypto",
    "//extensions/browser/updater",
    "//extensions/common:common_constants",
    "//extensions/common:mojom",
    "//net",
    "//services/data_decoder/public/cpp",
    "//services/network/public/cpp:cpp_base",
    "//services/network/public/mojom",
    "//services/network/public/mojom:url_loader_base",
    "//skia",
    "//third_party/blink/public/common:headers",
    "//third_party/blink/public/mojom/service_worker:storage",
    "//third_party/boringssl",
    "//ui/base",
    "//ui/base:types",
    "//ui/base/ime",
    "//ui/chromeos/strings",
    "//ui/chromeos/styles:cros_styles_views",
    "//ui/color:color_headers",
    "//ui/compositor",
    "//ui/events:event_constants",
    "//ui/gfx/codec",
    "//ui/message_center/public/cpp",
    "//ui/native_theme",
  ]

  if (enable_plugins) {
    sources += [
      "app_mode/kiosk_session_plugin_handler.cc",
      "app_mode/kiosk_session_plugin_handler.h",
      "app_mode/kiosk_session_plugin_handler_delegate.h",
    ]
  }

  if (is_chromeos_ash) {
    sources += [
      "app_mode/kiosk_troubleshooting_controller_ash.cc",
      "app_mode/kiosk_troubleshooting_controller_ash.h",
      "extensions/login_screen/login/cleanup/cleanup_manager_ash.cc",
      "extensions/login_screen/login/cleanup/cleanup_manager_ash.h",
      "extensions/login_screen/login/cleanup/clipboard_cleanup_handler.cc",
      "extensions/login_screen/login/cleanup/clipboard_cleanup_handler.h",
      "extensions/login_screen/login/cleanup/files_cleanup_handler.cc",
      "extensions/login_screen/login/cleanup/files_cleanup_handler.h",
      "extensions/login_screen/login/cleanup/lacros_cleanup_handler.cc",
      "extensions/login_screen/login/cleanup/lacros_cleanup_handler.h",
      "extensions/login_screen/login/cleanup/print_jobs_cleanup_handler.cc",
      "extensions/login_screen/login/cleanup/print_jobs_cleanup_handler.h",
      "extensions/login_screen/login/external_logout_done/external_logout_done_event_handler.cc",
      "extensions/login_screen/login/external_logout_done/external_logout_done_event_handler.h",
      "extensions/login_screen/login/external_logout_done/external_logout_done_event_handler_factory.cc",
      "extensions/login_screen/login/external_logout_done/external_logout_done_event_handler_factory.h",
      "extensions/login_screen/login/login_api_lock_handler.cc",
      "extensions/login_screen/login/login_api_lock_handler.h",
      "extensions/login_screen/login/shared_session_handler.cc",
      "extensions/login_screen/login/shared_session_handler.h",
      "reporting/websites/website_metrics_retriever_ash.cc",
      "reporting/websites/website_metrics_retriever_ash.h",
      "reporting/websites/website_usage_telemetry_periodic_collector_ash.cc",
      "reporting/websites/website_usage_telemetry_periodic_collector_ash.h",
    ]
    allow_circular_includes_from += [ "//chrome/browser/ash/crosapi" ]
    public_deps += [
      "//ash/constants",
      "//chrome/browser/ash/crosapi",
      "//components/services/app_service/public/cpp:instance_update",
    ]
    deps += [
      "//ash",
      "//ash/components/arc:arc_metrics_constants",
      "//ash/public/cpp",
      "//ash/webui/file_manager:constants",
      "//ash/webui/file_manager:file_manager_ui",
      "//ash/webui/file_manager:file_manager_untrusted_ui",
      "//chrome/browser/ash/video_conference",
      "//chrome/browser/ui/ash/system_web_apps:system_web_apps",
      "//chromeos/ash/components/chaps_util",
      "//chromeos/ash/components/login/auth/public:authpublic",
      "//chromeos/ash/components/login/session",
      "//chromeos/ash/components/settings",
      "//components/session_manager:base",
      "//components/session_manager/core",
      "//components/user_manager",
      "//ui/aura",
    ]
  }

  if (is_chromeos_lacros) {
    sources += [
      "extensions/login_screen/login/cleanup/cleanup_manager_lacros.cc",
      "extensions/login_screen/login/cleanup/cleanup_manager_lacros.h",
      "extensions/login_screen/login/cleanup/cleanup_manager_lacros_factory.cc",
      "extensions/login_screen/login/cleanup/cleanup_manager_lacros_factory.h",
      "policy/dlp/dlp_browser_helper_lacros.cc",
      "policy/dlp/dlp_browser_helper_lacros.h",
      "policy/dlp/dlp_content_manager_lacros.cc",
      "policy/dlp/dlp_content_manager_lacros.h",
      "policy/dlp/dlp_files_controller_lacros.cc",
      "policy/dlp/dlp_files_controller_lacros.h",
      "reporting/device_reporting_settings_lacros.cc",
      "reporting/device_reporting_settings_lacros.h",
      "reporting/metric_reporting_manager_lacros.cc",
      "reporting/metric_reporting_manager_lacros.h",
      "reporting/metric_reporting_manager_lacros_factory.cc",
      "reporting/metric_reporting_manager_lacros_factory.h",
      "reporting/metric_reporting_manager_lacros_shutdown_notifier_factory.cc",
      "reporting/metric_reporting_manager_lacros_shutdown_notifier_factory.h",
      "reporting/websites/website_metrics_retriever_lacros.cc",
      "reporting/websites/website_metrics_retriever_lacros.h",
      "reporting/websites/website_usage_telemetry_periodic_collector_lacros.cc",
      "reporting/websites/website_usage_telemetry_periodic_collector_lacros.h",
    ]
    public_deps += [
      "//chromeos/lacros",
      "//ui/aura",
    ]
    deps += [
      "//chromeos/startup",
      "//ui/platform_window",
    ]
  }

  if (use_cups) {
    sources += [
      "printing/cups_wrapper.cc",
      "printing/cups_wrapper.h",
      "printing/cups_wrapper_impl.cc",
      "printing/printer_error_codes.cc",
      "printing/printer_error_codes.h",
    ]
    public_deps += [ "//printing/backend" ]
    deps += [
      "//chromeos/components/print_management/mojom",
      "//printing:printing_base",
    ]
  }
}

static_library("test_support") {
  testonly = true
  sources = [
    "extensions/login_screen/login/cleanup/mock_cleanup_handler.cc",
    "extensions/login_screen/login/cleanup/mock_cleanup_handler.h",
    "policy/dlp/dialogs/mock_dlp_warn_notifier.cc",
    "policy/dlp/dialogs/mock_dlp_warn_notifier.h",
    "policy/dlp/test/dlp_content_manager_test_helper.cc",
    "policy/dlp/test/dlp_content_manager_test_helper.h",
    "policy/dlp/test/dlp_files_test_base.cc",
    "policy/dlp/test/dlp_files_test_base.h",
    "policy/dlp/test/dlp_rules_manager_test_utils.cc",
    "policy/dlp/test/dlp_rules_manager_test_utils.h",
    "policy/dlp/test/mock_dlp_content_manager.cc",
    "policy/dlp/test/mock_dlp_content_manager.h",
    "policy/dlp/test/mock_dlp_content_observer.cc",
    "policy/dlp/test/mock_dlp_content_observer.h",
    "policy/dlp/test/mock_dlp_rules_manager.cc",
    "policy/dlp/test/mock_dlp_rules_manager.h",
  ]
  public_deps = [
    ":chromeos",
    "//base",
    "//build:chromeos_buildflags",
    "//chrome/test:test_support",
    "//content/test:test_support",
    "//crypto:test_support",
    "//testing/gmock",
    "//testing/gtest",
    "//ui/views",
    "//url",
  ]

  if (is_chromeos_ash) {
    public_deps += [ "//chrome/browser/ash:test_support" ]
  }

  deps = [
    "//chrome/browser/enterprise/data_controls",
    "//components/enterprise/data_controls:dlp_policy_event_proto",
    "//components/reporting/client:test_support",
  ]

  if (is_chromeos_ash) {
    public_deps += [ "//chrome/browser/ash" ]
  }
}

source_set("unit_tests") {
  testonly = true

  sources = [
    "app_mode/chrome_kiosk_external_loader_broker_unittest.cc",
    "app_mode/kiosk_app_service_launcher_unittest.cc",
    "app_mode/kiosk_browser_session_unittest.cc",
    "app_mode/kiosk_policies_unittest.cc",
    "arc/arc_external_protocol_dialog_unittest.cc",
    "arc/open_with_menu_unittest.cc",
    "extensions/contact_center_insights/contact_center_insights_extension_manager_unittest.cc",
    "extensions/desk_api/desk_api_extension_manager_unittest.cc",
    "extensions/file_system_provider/service_worker_lifetime_manager_unittest.cc",
    "extensions/login_screen/login/cleanup/cleanup_manager_unittest.cc",
    "extensions/login_screen/login/external_logout_request/external_logout_request_event_handler_unittest.cc",
    "extensions/login_screen/login_state/login_state_api_unittest.cc",
    "policy/dlp/data_transfer_dlp_controller_unittest.cc",
    "policy/dlp/dlp_clipboard_notifier_unittest.cc",
    "policy/dlp/dlp_confidential_contents_unittest.cc",
    "policy/dlp/dlp_confidential_file_unittest.cc",
    "policy/dlp/dlp_content_tab_helper_unittest.cc",
    "policy/dlp/dlp_copy_or_move_hook_delegate_unittest.cc",
    "policy/dlp/dlp_drag_drop_notifier_unittest.cc",
    "policy/dlp/dlp_file_access_copy_or_move_delegate_factory_unittest.cc",
    "policy/dlp/dlp_files_controller_unittest.cc",
    "policy/dlp/dlp_files_utils_unittest.cc",
    "policy/dlp/dlp_rules_manager_impl_unittest.cc",
    "policy/dlp/dlp_scoped_file_access_delegate_unittest.cc",
    "reporting/metric_reporting_prefs_unittest.cc",
    "reporting/network/network_bandwidth_sampler_unittest.cc",
    "reporting/usage_telemetry_periodic_collector_base_unittest.cc",
    "reporting/user_reporting_settings_unittest.cc",
    "reporting/websites/website_events_observer_unittest.cc",
    "reporting/websites/website_usage_observer_unittest.cc",
    "reporting/websites/website_usage_telemetry_sampler_unittest.cc",
    "tast_support/stack_sampling_recorder_unittest.cc",
    "video_conference/video_conference_ukm_helper_unittest.cc",

    # TODO(zturner): Enable this on Windows. See
    # BrowserWithTestWindowTest::SetUp() for a comment explaining why this is
    # broken.
    "../../common/extensions/api/file_browser_handlers/file_browser_handler_manifest_unittest.cc",
    "../../common/extensions/api/file_system_provider/file_system_provider_handler_unittest.cc",
  ]
  deps = [
    ":chromeos",
    ":system_stack_sampled_metrics_status_proto",
    ":test_support",
    "//base",
    "//base/test:test_support",
    "//build:chromeos_buildflags",
    "//chrome/app:command_ids",
    "//chrome/app:generated_resources",
    "//chrome/browser",
    "//chrome/browser:browser_process",
    "//chrome/browser/apps/app_service:test_support",
    "//chrome/browser/enterprise/data_controls",
    "//chrome/browser/enterprise/data_controls:test_support",
    "//chrome/browser/extensions",
    "//chrome/browser/profiles:profile",
    "//chrome/browser/sharing/proto",
    "//chrome/browser/ui",
    "//chrome/common",
    "//chrome/common:chrome_features",
    "//chrome/common:constants",
    "//chrome/common:non_code_constants",
    "//chrome/common/extensions/api",
    "//chrome/test:test_support",
    "//chromeos/components/kcer",
    "//chromeos/components/kcer:key_permissions_proto",
    "//chromeos/crosapi/mojom",
    "//chromeos/dbus/dlp",
    "//components/account_id",
    "//components/arc/common",
    "//components/arc/common:arc_intent_helper_constants",
    "//components/arc/common:arc_test_support",
    "//components/enterprise/data_controls",
    "//components/enterprise/data_controls:dlp_policy_event_proto",
    "//components/file_access",
    "//components/keyed_service/core",
    "//components/policy/core/common:common_constants",
    "//components/prefs",
    "//components/renderer_context_menu",
    "//components/reporting/client:test_support",
    "//components/reporting/metrics/fakes:test_support",
    "//components/reporting/proto:metric_data_proto",
    "//components/reporting/storage:test_support",
    "//components/reporting/util:status",
    "//components/reporting/util:test_callbacks_support",
    "//components/strings:components_strings",
    "//components/ukm",
    "//components/user_manager",
    "//content/public/browser",
    "//content/test:test_support",
    "//extensions:test_support",
    "//extensions/browser",
    "//extensions/browser:test_support",
    "//extensions/common",
    "//extensions/common:common_constants",
    "//storage/browser",
    "//storage/browser:test_support",
    "//testing/gmock",
    "//testing/gtest",
    "//third_party/abseil-cpp:absl",
    "//ui/base",
    "//ui/base/data_transfer_policy",
    "//ui/gfx",
    "//ui/views",
    "//url",

    # Unit tests from subdirectories.
    "//chrome/browser/chromeos/drivefs:unit_tests",
    "//chrome/browser/chromeos/extensions/telemetry:unit_tests",
    "//chrome/browser/chromeos/launcher_search:unit_tests",
  ]

  if (enable_plugins) {
    sources += [ "app_mode/kiosk_session_plugin_handler_unittest.cc" ]
  }

  if (is_chromeos_ash) {
    sources += [
      "app_mode/chrome_kiosk_app_launcher_unittest.cc",
      "extensions/login_screen/login/cleanup/extension_cleanup_handler_unittest.cc",
      "extensions/login_screen/login/cleanup/lacros_cleanup_handler_unittest.cc",
      "extensions/login_screen/login/cleanup/print_jobs_cleanup_handler_unittest.cc",
      "extensions/login_screen/login/external_logout_done/external_logout_done_event_handler_unittest.cc",
      "extensions/login_screen/login/login_api_ash_unittest.cc",
      "extensions/login_screen/login_screen_storage/login_screen_storage_api_ash_unittest.cc",
      "extensions/login_screen/login_state/session_state_changed_event_dispatcher_ash_unittest.cc",
      "reporting/websites/website_metrics_retriever_ash_unittest.cc",
      "reporting/websites/website_usage_telemetry_periodic_collector_ash_unittest.cc",
      "tablet_mode/chrome_content_browser_client_tablet_mode_part_unittest.cc",
    ]
    deps += [
      "//ash:test_support",
      "//ash/constants",
      "//chrome/browser/ash",
      "//chrome/browser/ash:test_support",
      "//chrome/browser/ash/crosapi",
      "//chrome/browser/ash/crosapi:test_support",
      "//chrome/browser/ash/system_web_apps/test_support:test_support",
      "//chrome/browser/extensions:test_support",
      "//chrome/browser/ui/ash/system_web_apps:system_web_apps",
      "//chrome/browser/web_applications:web_applications_test_support",
      "//chromeos/ash/components/dbus/session_manager",
      "//chromeos/ash/components/login/auth/public:authpublic",
      "//chromeos/ash/components/login/login_state",
      "//chromeos/ash/components/settings",
      "//chromeos/dbus/power",
      "//components/history/core/test",
      "//components/prefs:test_support",
      "//components/services/app_service",
      "//components/session_manager:base",
      "//components/session_manager/core",
      "//components/sync_preferences:test_support",
      "//components/user_manager",
      "//content/public/common",
      "//extensions/common/api",
      "//mojo/public/cpp/bindings",
      "//ui/gfx/geometry",
    ]

    if (use_cups) {
      sources +=
          [ "extensions/printing_metrics/printing_metrics_api_unittest.cc" ]
      deps += [
        "//chrome/browser/ash:print_job_info_proto",
        "//chrome/browser/ash:test_support",
        "//chrome/browser/chromeos/extensions/printing_metrics",
        "//chrome/common/extensions/api",
      ]
    }
  }

  if (is_chromeos_lacros) {
    sources += [
      "policy/dlp/dlp_files_controller_lacros_unittest.cc",
      "reporting/device_reporting_settings_lacros_unittest.cc",
      "reporting/metric_reporting_manager_lacros_factory_unittest.cc",
      "reporting/metric_reporting_manager_lacros_shutdown_notifier_factory_unittest.cc",
      "reporting/metric_reporting_manager_lacros_unittest.cc",
      "reporting/websites/website_metrics_retriever_lacros_unittest.cc",
      "reporting/websites/website_usage_telemetry_periodic_collector_lacros_unittest.cc",
    ]
    deps += [
      "//chromeos/lacros",
      "//chromeos/startup",
      "//components/reporting/metrics:metrics_data_collection",
      "//components/reporting/metrics/fakes:test_support",
      "//components/reporting/util:rate_limiter_interface",
    ]
  }
}

proto_library("system_stack_sampled_metrics_status_proto") {
  sources = [ "//third_party/cros_system_api/proto/stack_sampled_metrics_status//stack_sampled_metrics_status.proto" ]

  proto_out_dir =
      "third_party/cros_system_api/proto/stack_sampled_metrics_status"
}
