#!/usr/bin/env python3
"""Packages Cobalt for Linux."""

import argparse
import os
import shutil
import tempfile


def main():
  parser = argparse.ArgumentParser()
  parser.add_argument('--name', required=True, help='of archive and base dir')
  parser.add_argument('out_dir', help='generated by GN and built by Ninja')
  parser.add_argument('package_dir', help='where to place the archive')
  args = parser.parse_args()
  package(args.out_dir, args.package_dir, args.name)


def package(out_dir, package_dir, name):
  with tempfile.TemporaryDirectory() as tmp_dir:
    base_dir = os.path.join(tmp_dir, name)
    os.makedirs(base_dir)

    place_in_base_dir = [
        'cobalt',
        'content_shell.pak',
        'icudtl.dat',
        'libEGL.so',
        'libGLESv2.so',
        'starboard/libstarboard.so.17',
        'v8_context_snapshot.bin',
    ]
    for f in place_in_base_dir:
      shutil.copy2(os.path.join(out_dir, f), base_dir)

    shutil.make_archive(os.path.join(package_dir, name), 'zip', tmp_dir)


if __name__ == '__main__':
  main()
