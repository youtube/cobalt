description="Adds missing dependencies to BUILD.gn files to reflect includes"
prompt = """
Your goal is to ensure that if a header file from //foo includes a header file
from //bar, then //foo depends on //bar in the dependency graph.

A tool exists to check this for you - `gn check -C <output directory>`. If you
can't work out the output directory, you might have to ask the user.

You will repeatedly run that command until it succeeds. For each missing
dependency, it will output something along the lines of:
```
ERROR at //$INCLUDER: Include not allowed.
#include "$INCLUDED"
          ^----------------
It is not in any dependency of
  $INCLUDER_TARGET
The include file is in the target(s):
  $INCLUDED_TARGET
which should somehow be reachable.
```

Sometimes it may instead say something similar like "It's usually best to depend
directly on the destination target", and then output a dependency chain. You can
treat this in the same way (it's still $INCLUDED_TARGET as a direct dependency,
but happens to have it as a transitive one).

Here, it is saying that the:
* The file $INCLUDER attempted to include the header $INCLUDED.
* The file $INCLUDER is a source / public in $INCLUDER_TARGET
* The file $INCLUDED is a public header in $INCLUDED_TARGET
* The target $INCLUDER_TARGET did not depend on $INCLUDED_TARGET (or perhaps it
  was in deps, but needed to be in public_deps)

To fix this, you need to:
* If $INCLUDER is a source file (a .cc file, or a .h file that is not public),
  then add $INCLUDED_TARGET to $INCLUDER_TARGET's deps
* If $INCLUDER is a public file (a .h file that is public), then add
  $INCLUDED_TARGET to $INCLUDER_TARGET's public_deps
* If something would be both a dep and a public dep, it only needs to be
  specified as a public dep
* Make sure not to specify the same dependency multiple times. You only need to
  specify it once.
* Don't forget to read the file and work out whether $INCLUDER conditionally
  included $INCLUDED. If it did, then you'll need a corresponding
  condition in the BUILD.gn file. If you can't work out the condition, try:
  * Searching for other similar conditions in the header file and seeing what
    they did in their BUILD.gn
  * If you still can't work it out, set the condition to `true` and add a TODO
    comment on the line before. When you finish fixing it, make sure to report
    this to the user.
* Try and fix these in parallel. They're mostly unrelated, but can be slow to
  fix. Start with 20 at a time and feel free to adjust up or down based on if
  you're getting too many errors. You can run the `gn check` after you've fixed
  the whole chunk (or if you're struggling with part of the chunk, revert that
  part and move it to the next chunk).
* Be careful not to include random backslashes.
* Do not make any edits other than adding dependencies on $INCLUDED_TARGET for
  $INCLUDER_TARGET. Be careful not to touch existing dependencies. Don't add
  blank lines.
* Make sure to look at the BUILD file you want to edit to find the place you
  want to insert the dependency before trying to edit it

Some notes about GN for you:
* As shorthand, the target //foo:foo can be written as //foo
* //foo:bar is generated by the build file foo/BUILD.gn
* The gn terms "source" and "public" roughly refer to implementation and
  interface respectively.
* If a target contains only sources, and no public, then all sources are
  public.
* Don't make assumptions about the target type when trying to find the
  definition of a target (eg. Look for `"foo"` instead of
  `static_library("foo")` when trying to find the target "foo")
* Make sure to add the dependencies in sorted order if possible.

GN might also output errors of a different kind:
* It might start with GN compilation errors. Don't try and fix this, just stop
  and show the user the error.
* You might introduce a problem in your fix. If that happens, undo your fix and
  try something different. If you can't fix it, you can ask the user to fix it
  themselves.
"""
