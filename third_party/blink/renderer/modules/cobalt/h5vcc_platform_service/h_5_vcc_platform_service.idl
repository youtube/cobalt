// Copyright 2026 The Cobalt Authors. All Rights Reserved.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
//     http://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.

// This interface mirrors the H5vccPlatformService interface from 25.lts.stable:
// https://github.com/youtube/cobalt/blob/25.lts.stable/cobalt/h5vcc/h5vcc_platform_service.idl.
// To adhere to web and Chromium best practices we may consider changing these
// APIs to be asynchronous (return promises). At the time of writing it was
// deemed too expensive to migrate existing web clients to async APIs.
[
  Exposed=Window,
  SecureContext,
  ImplementedAs=H5vccPlatformService  // Fixes capitalization issue in bindings.
]
interface H5vccPlatformService {
  // Returns true if the given service exists on the platform, false otherwise.
  [CallWith=ScriptState] static boolean has(DOMString service_name);

  // Opens and returns a service with the specified name.
  // Returns null if no service of the specified name exists.
  // Data may be received via the |receive_callback| the moment after this
  // function returns non-null.
  [CallWith=ScriptState] static H5vccPlatformService? open(DOMString service_name, ReceiveCallback receive_callback);

  // Sends the specified data to the service. The service
  // may optionally synchronously return data. For asynchronous
  // responses the service should utilize the |receive_callback|.
  // If the service has been closed, then kInvalidStateErr is raised.
  // If the service is open but not currently able to accept data, then
  // kInvalidStateErr is raised.
  [RaisesException] ArrayBuffer? send(ArrayBuffer data);

  // Closes the specified service.  After calling Close(), it is
  // guaranteed that |receive_callback| will no longer be called, and
  // subsequent calls to send() are considered errors.
  void close();
};

// When a service is opened a callback must be registered to enable push
// communications from the service.  A service may use the receive callback
// to asynchronously respond to a previous Send() call.
//
// NOTE: the implementation guarantees that data will in fact be of type
// ArrayBuffer, so the web client can - and should - assume this type.
// TODO: b/371419798 - change the type of data from any to ArrayBuffer once the
// const correctness issue in the Blink IDL compiler is resolved.
callback ReceiveCallback = void (H5vccPlatformService service, any data);
